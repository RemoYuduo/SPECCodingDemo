# 企业内部福利商城 - 后端架构信息

- **版本**: v1.0.0
- **更新日期**: 2023-12-15
- **技术栈**: Node.js + Express.js + SQLite + JWT + bcryptjs
- **状态**: 开发中

## 目录结构

```
backend/
├── src/
│   ├── controllers/            # 控制器层
│   │   ├── authController.js  # 认证控制器
│   │   ├── userController.js  # 用户控制器
│   │   ├── productController.js # 商品控制器
│   │   ├── cartController.js  # 购物车控制器
│   │   ├── orderController.js # 订单控制器
│   │   └── adminController.js # 管理员控制器
│   ├── services/              # 业务逻辑层
│   │   ├── authService.js     # 认证服务
│   │   ├── userService.js     # 用户服务
│   │   ├── productService.js  # 商品服务
│   │   ├── cartService.js     # 购物车服务
│   │   ├── orderService.js    # 订单服务
│   │   └── adminService.js    # 管理员服务
│   ├── models/                # 数据模型层
│   │   ├── User.js            # 用户模型
│   │   ├── Product.js         # 商品模型
│   │   ├── Category.js        # 商品分类模型
│   │   ├── Cart.js            # 购物车模型
│   │   ├── Order.js           # 订单模型
│   │   ├── OrderItem.js       # 订单项模型
│   │   ├── Address.js         # 收货地址模型
│   │   ├── PointsRecord.js    # 积分记录模型
│   │   └── SystemConfig.js     # 系统配置模型
│   ├── routes/                # 路由层
│   │   ├── auth.js            # 认证路由(已实现)
│   │   ├── user.js            # 用户路由(已实现)
│   │   ├── product.js         # 商品路由
│   │   ├── cart.js            # 购物车路由
│   │   ├── order.js           # 订单路由
│   │   ├── admin.js           # 管理员路由(已实现)
│   │   └── health.js          # 健康检查路由(已实现)
│   ├── middleware/            # 中间件
│   │   ├── auth.js            # 认证中间件(已实现)
│   │   ├── validation.js      # 数据验证中间件
│   │   ├── rateLimit.js       # 请求限流中间件
│   │   ├── logger.js          # 日志中间件
│   │   └── error.js           # 错误处理中间件(已实现)
│   ├── config/                # 配置文件
│   │   ├── database.js        # 数据库配置(已实现)
│   │   ├── app.js             # 应用配置(已实现)
│   │   ├── jwt.js             # JWT配置
│   │   └── constants.js       # 常量定义
│   ├── database/              # 数据库相关
│   │   ├── init.js            # 数据库初始化(已实现)
│   │   ├── migrations/        # 数据库迁移文件
│   │   └── seeds/             # 数据库种子文件
│   └── utils/                 # 工具函数
│       ├── response.js        # 响应格式化工具
│       ├── encryption.js      # 加密工具
│       ├── fileUpload.js      # 文件上传工具
│       └── validators.js      # 验证工具
├── database/                  # 数据库文件存储
│   └── mall.db               # SQLite数据库文件
├── logs/                      # 日志文件
├── uploads/                   # 上传文件存储
│   └── products/             # 商品图片存储
├── .env                       # 环境变量配置
├── .gitignore                 # Git忽略文件
├── package.json               # 依赖配置(已实现)
├── package-lock.json          # 依赖锁定文件
└── server.js                  # 服务器入口文件(已实现)
```

## 模块外部特性

### 1. 认证模块 (auth)
- **authController.js**: 认证控制器
  - 功能: 处理登录、登出、注册等认证请求
  - 状态: 已实现基础功能
  - 依赖: authService.js, auth.js(middleware)
- **authService.js**: 认证服务
  - 功能: 用户身份验证、JWT令牌生成与验证、密码验证
  - 状态: 已实现基础功能
  - 依赖: User.js(model), bcryptjs, jsonwebtoken
- **auth.js**: 认证路由
  - 功能: 定义登录、注册、登出等认证相关路由
  - 状态: 已实现基础功能
  - 依赖: authController.js, auth.js(middleware)

### 2. 用户模块 (user)
- **userController.js**: 用户控制器
  - 功能: 处理用户信息获取、更新、积分查询等请求
  - 状态: 已实现基础功能
  - 依赖: userService.js, auth.js(middleware)
- **userService.js**: 用户服务
  - 功能: 用户信息管理、积分记录管理、收货地址管理
  - 状态: 已实现基础功能
  - 依赖: User.js(model), PointsRecord.js(model), Address.js(model)
- **user.js**: 用户路由
  - 功能: 定义用户信息、积分、地址等相关路由
  - 状态: 已实现基础功能
  - 依赖: userController.js, auth.js(middleware)

### 3. 商品模块 (product)
- **productController.js**: 商品控制器
  - 功能: 处理商品列表、详情、搜索等请求
  - 状态: 未实现
  - 依赖: productService.js
- **productService.js**: 商品服务
  - 功能: 商品信息管理、分类管理、库存管理、商品搜索
  - 状态: 未实现
  - 依赖: Product.js(model), Category.js(model)
- **product.js**: 商品路由
  - 功能: 定义商品列表、详情、搜索等相关路由
  - 状态: 未实现
  - 依赖: productController.js

### 4. 购物车模块 (cart)
- **cartController.js**: 购物车控制器
  - 功能: 处理购物车增删改查等请求
  - 状态: 未实现
  - 依赖: cartService.js, auth.js(middleware)
- **cartService.js**: 购物车服务
  - 功能: 购物车商品管理、数量调整、选中状态管理
  - 状态: 未实现
  - 依赖: Cart.js(model), Product.js(model)
- **cart.js**: 购物车路由
  - 功能: 定义购物车相关路由
  - 状态: 未实现
  - 依赖: cartController.js, auth.js(middleware)

### 5. 订单模块 (order)
- **orderController.js**: 订单控制器
  - 功能: 处理订单创建、查询、取消等请求
  - 状态: 未实现
  - 依赖: orderService.js, auth.js(middleware)
- **orderService.js**: 订单服务
  - 功能: 订单创建、订单状态管理、订单详情查询
  - 状态: 未实现
  - 依赖: Order.js(model), OrderItem.js(model), Cart.js(model)
- **order.js**: 订单路由
  - 功能: 定义订单相关路由
  - 状态: 未实现
  - 依赖: orderController.js, auth.js(middleware)

### 6. 管理员模块 (admin)
- **adminController.js**: 管理员控制器
  - 功能: 处理管理员相关请求、系统管理
  - 状态: 已实现基础功能
  - 依赖: adminService.js, auth.js(middleware)
- **adminService.js**: 管理员服务
  - 功能: 商品管理、订单管理、用户管理、系统设置
  - 状态: 已实现基础功能
  - 依赖: 所有模型
- **admin.js**: 管理员路由
  - 功能: 定义管理员相关路由
  - 状态: 已实现基础功能
  - 依赖: adminController.js, auth.js(middleware)

### 7. 数据模型 (models)
- **User.js**: 用户模型
  - 功能: 用户数据结构定义、用户相关数据操作
  - 状态: 已实现基础功能
  - 依赖: database.js
- **Product.js**: 商品模型
  - 功能: 商品数据结构定义、商品相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **Category.js**: 商品分类模型
  - 功能: 商品分类数据结构定义、分类相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **Cart.js**: 购物车模型
  - 功能: 购物车数据结构定义、购物车相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **Order.js**: 订单模型
  - 功能: 订单数据结构定义、订单相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **OrderItem.js**: 订单项模型
  - 功能: 订单项数据结构定义、订单项相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **Address.js**: 收货地址模型
  - 功能: 收货地址数据结构定义、地址相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **PointsRecord.js**: 积分记录模型
  - 功能: 积分记录数据结构定义、积分记录相关数据操作
  - 状态: 未实现
  - 依赖: database.js
- **SystemConfig.js**: 系统配置模型
  - 功能: 系统配置数据结构定义、配置相关数据操作
  - 状态: 未实现
  - 依赖: database.js

### 8. 中间件 (middleware)
- **auth.js**: 认证中间件
  - 功能: JWT令牌验证、用户身份识别、权限控制
  - 状态: 已实现基础功能
  - 依赖: jwt.js(config), User.js(model)
- **validation.js**: 数据验证中间件
  - 功能: 请求数据验证、格式检查、数据清洗
  - 状态: 未实现
  - 依赖: express-validator
- **rateLimit.js**: 请求限流中间件
  - 功能: 请求频率限制、防爬虫、防DDOS攻击
  - 状态: 未实现
  - 依赖: express-rate-limit
- **logger.js**: 日志中间件
  - 功能: 请求日志记录、错误日志记录、性能监控
  - 状态: 未实现
  - 依赖: morgan, winston
- **error.js**: 错误处理中间件
  - 功能: 统一错误处理、错误响应格式化
  - 状态: 已实现基础功能
  - 依赖: 无

### 9. 配置模块 (config)
- **database.js**: 数据库配置
  - 功能: SQLite数据库连接、连接池管理、数据库配置
  - 状态: 已实现基础功能
  - 依赖: sqlite3
- **app.js**: 应用配置
  - 功能: 应用全局配置、环境变量管理
  - 状态: 已实现基础功能
  - 依赖: dotenv
- **jwt.js**: JWT配置
  - 功能: JWT令牌配置、密钥管理、过期时间设置
  - 状态: 未实现
  - 依赖: jsonwebtoken
- **constants.js**: 常量定义
  - 功能: 系统常量定义、错误码定义、状态码定义
  - 状态: 未实现
  - 依赖: 无

### 10. 数据库模块 (database)
- **init.js**: 数据库初始化
  - 功能: 数据库表创建、初始数据插入、数据库版本管理
  - 状态: 已实现基础功能
  - 依赖: database.js(config)
- **migrations/**: 数据库迁移文件
  - 功能: 数据库结构变更、版本升级、数据迁移
  - 状态: 未实现
  - 依赖: database.js(config)
- **seeds/**: 数据库种子文件
  - 功能: 测试数据生成、开发数据初始化
  - 状态: 未实现
  - 依赖: database.js(config)

### 11. 工具函数 (utils)
- **response.js**: 响应格式化工具
  - 功能: 统一响应格式、成功响应、错误响应
  - 状态: 未实现
  - 依赖: 无
- **encryption.js**: 加密工具
  - 功能: 数据加密、数据解密、密码加密
  - 状态: 未实现
  - 依赖: bcryptjs
- **fileUpload.js**: 文件上传工具
  - 功能: 文件上传、图片处理、文件存储
  - 状态: 未实现
  - 依赖: multer, sharp
- **validators.js**: 验证工具
  - 功能: 数据验证规则、自定义验证函数
  - 状态: 未实现
  - 依赖: 无

### 12. 健康检查模块 (health)
- **health.js**: 健康检查路由
  - 功能: 服务健康检查、数据库状态检查
  - 状态: 已实现基础功能
  - 依赖: database.js(config)

### 13. 服务器入口 (server.js)
- **server.js**: 服务器入口文件
  - 功能: Express服务器配置、路由注册、中间件应用、错误处理、数据库初始化
  - 状态: 已实现基础功能
  - 依赖: 所有模块