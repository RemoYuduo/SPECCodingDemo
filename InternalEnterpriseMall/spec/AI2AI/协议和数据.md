# 企业内部福利商城 - 协议和数据

## 前后端API协议

### 认证相关API

#### 用户登录
```
POST /api/auth/login
Request Body:
{
  "username": "string",
  "password": "string",
  "type": "user|admin"
}

Response:
{
  "success": true,
  "token": "string",
  "userType": "user|admin",
  "userId": "number"
}
```

### 用户相关API

#### 获取用户信息
```
GET /api/user/profile
Headers: Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "id": "number",
    "username": "string",
    "email": "string",
    "points": "number",
    "createdAt": "string"
  }
}
```

#### 更新用户信息
```
PUT /api/user/profile
Headers: Authorization: Bearer <token>
Request Body:
{
  "email": "string",
  "phone": "string"
}

Response:
{
  "success": true,
  "data": "更新后的用户信息"
}
```

### 商品相关API

#### 获取商品列表
```
GET /api/products?page=1&limit=10&category=string

Response:
{
  "success": true,
  "data": {
    "products": [
      {
        "id": "number",
        "name": "string",
        "description": "string",
        "price": "number",
        "pointsRequired": "number",
        "stock": "number",
        "image": "string",
        "status": "active|inactive",
        "category": "string"
      }
    ],
    "pagination": {
      "page": "number",
      "limit": "number",
      "total": "number"
    }
  }
}
```

#### 获取商品详情
```
GET /api/products/:id

Response:
{
  "success": true,
  "data": {
    "id": "number",
    "name": "string",
    "description": "string",
    "price": "number",
    "pointsRequired": "number",
    "stock": "number",
    "image": "string",
    "status": "active|inactive",
    "category": "string",
    "createdAt": "string",
    "updatedAt": "string"
  }
}
```

### 购物车相关API

#### 添加商品到购物车
```
POST /api/cart
Headers: Authorization: Bearer <token>
Request Body:
{
  "productId": "number",
  "quantity": "number"
}

Response:
{
  "success": true,
  "data": "购物车信息"
}
```

#### 获取购物车
```
GET /api/cart
Headers: Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "items": [
      {
        "productId": "number",
        "productName": "string",
        "quantity": "number",
        "pointsRequired": "number",
        "totalPoints": "number"
      }
    ],
    "totalPoints": "number"
  }
}
```

### 订单相关API

#### 创建订单
```
POST /api/orders
Headers: Authorization: Bearer <token>
Request Body:
{
  "items": [
    {
      "productId": "number",
      "quantity": "number"
    }
  ],
  "shippingAddress": "string"
}

Response:
{
  "success": true,
  "data": {
    "orderId": "string",
    "totalPoints": "number",
    "status": "pending"
  }
}
```

#### 获取订单列表
```
GET /api/orders?page=1&limit=10
Headers: Authorization: Bearer <token>

Response:
{
  "success": true,
  "data": {
    "orders": [
      {
        "id": "string",
        "status": "pending|processing|completed|cancelled",
        "totalPoints": "number",
        "createdAt": "string",
        "items": [
          {
            "productId": "number",
            "productName": "string",
            "quantity": "number",
            "pointsRequired": "number"
          }
        ]
      }
    ],
    "pagination": {
      "page": "number",
      "limit": "number",
      "total": "number"
    }
  }
}
```

### 管理员相关API

#### 创建商品
```
POST /api/admin/products
Headers: Authorization: Bearer <admin_token>
Request Body:
{
  "name": "string",
  "description": "string",
  "price": "number",
  "pointsRequired": "number",
  "stock": "number",
  "image": "string",
  "category": "string"
}

Response:
{
  "success": true,
  "data": "新创建的商品信息"
}
```

#### 更新商品状态
```
PUT /api/admin/products/:id/status
Headers: Authorization: Bearer <admin_token>
Request Body:
{
  "status": "active|inactive"
}

Response:
{
  "success": true,
  "data": "更新后的商品信息"
}
```

#### 更新库存
```
PUT /api/admin/products/:id/stock
Headers: Authorization: Bearer <admin_token>
Request Body:
{
  "stock": "number"
}

Response:
{
  "success": true,
  "data": "更新后的商品信息"
}
```

## 数据库设计

### 用户表 (users)
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  email TEXT,
  phone TEXT,
  points INTEGER DEFAULT 0,
  role TEXT DEFAULT 'user', -- 'user' or 'admin'
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 商品表 (products)
```sql
CREATE TABLE products (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  description TEXT,
  price REAL NOT NULL,
  points_required INTEGER NOT NULL,
  stock INTEGER DEFAULT 0,
  image TEXT,
  status TEXT DEFAULT 'active', -- 'active' or 'inactive'
  category TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 订单表 (orders)
```sql
CREATE TABLE orders (
  id TEXT PRIMARY KEY, -- UUID
  user_id INTEGER NOT NULL,
  total_points INTEGER NOT NULL,
  status TEXT DEFAULT 'pending', -- 'pending', 'processing', 'completed', 'cancelled'
  shipping_address TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users (id)
);
```

### 订单明细表 (order_items)
```sql
CREATE TABLE order_items (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_id TEXT NOT NULL,
  product_id INTEGER NOT NULL,
  quantity INTEGER NOT NULL,
  points_required INTEGER NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (order_id) REFERENCES orders (id),
  FOREIGN KEY (product_id) REFERENCES products (id)
);
```

### 购物车表 (cart)
```sql
CREATE TABLE cart (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  product_id INTEGER NOT NULL,
  quantity INTEGER NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users (id),
  FOREIGN KEY (product_id) REFERENCES products (id),
  UNIQUE(user_id, product_id)
);
```

### 积分记录表 (points_history)
```sql
CREATE TABLE points_history (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  points_change INTEGER NOT NULL,
  type TEXT NOT NULL, -- 'earn', 'spend'
  description TEXT,
  reference_id TEXT, -- 订单ID等关联ID
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users (id)
);
```